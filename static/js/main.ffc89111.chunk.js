(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{13:function(e,t,a){e.exports=a(24)},24:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(10),l=a.n(c),o=a(27),s=a(28),i=a(29),m=a(25),u=a(26),d=a(31);const h="fa95a427198e4d4790c0be1b9a5d994c",p="https://j4mest.github.io/",f="user-read-currently-playing user-read-playback-state",w="https://accounts.spotify.com/authorize",g="https://accounts.spotify.com/api/token";function E(){const[e,t]=Object(n.useState)(null),[a,c]=Object(n.useState)(null),[l,o]=Object(n.useState)(null);Object(n.useEffect)(()=>{const e=new URLSearchParams(window.location.search).get("code"),a=localStorage.getItem("access_token"),n=localStorage.getItem("refresh_token");if(e){const a=localStorage.getItem("pkce_verifier");fetch(g,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",code:e,redirect_uri:p,client_id:h,code_verifier:a})}).then(e=>e.json()).then(e=>{localStorage.setItem("access_token",e.access_token),localStorage.setItem("refresh_token",e.refresh_token),t(e.access_token),c(e.refresh_token),window.history.replaceState({},document.title,window.location.pathname)}).catch(console.error)}else a&&(t(a),c(n))},[]);const s=Object(n.useCallback)(async()=>{const e=function(){const e=new Uint8Array(64);return window.crypto.getRandomValues(e),btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(),t=await async function(e){const t=(new TextEncoder).encode(e),a=await window.crypto.subtle.digest("SHA-256",t);return btoa(String.fromCharCode(...new Uint8Array(a))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(e);localStorage.setItem("pkce_verifier",e),window.location=`${w}?client_id=${h}`+"&response_type=code"+`&redirect_uri=${encodeURIComponent(p)}`+`&scope=${encodeURIComponent(f)}`+"&code_challenge_method=S256"+`&code_challenge=${t}`},[]),i=Object(n.useCallback)(()=>{a&&fetch(g,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:a,client_id:h})}).then(e=>e.json()).then(e=>{localStorage.setItem("access_token",e.access_token),t(e.access_token)}).catch(console.error)},[a]);return Object(n.useEffect)(()=>{if(!e)return;const t=async()=>{const t=await fetch("https://api.spotify.com/v1/me/player/currently-playing",{headers:{Authorization:`Bearer ${e}`}});if(401===t.status)return i();if(204===t.status||!t.ok)return o(null);const a=await t.json();a.is_playing&&a.item?o({title:a.item.name,artists:a.item.artists.map(e=>e.name).join(", "),albumArt:a.item.album.images[0].url,url:a.item.external_urls.spotify}):o(null)};t();const a=setInterval(t,15e3);return()=>clearInterval(a)},[e,i]),e?l?r.a.createElement(d.a,{bg:"dark",text:"white",style:{maxWidth:"400px"}},r.a.createElement(d.a.Body,{className:"d-flex"},r.a.createElement("img",{src:l.albumArt,alt:l.title,className:"rounded me-3",style:{width:"64px",height:"64px"}}),r.a.createElement("div",null,r.a.createElement(d.a.Title,null,r.a.createElement("a",{href:l.url,target:"_blank",rel:"noopener noreferrer",className:"link-success"},"\ud83c\udfa7 ",l.title)),r.a.createElement(d.a.Text,null,l.artists)))):r.a.createElement(u.a,{animation:"border",role:"status",size:"sm"},r.a.createElement("span",{className:"visually-hidden"},"Nothing playing right now.")):r.a.createElement(m.a,{variant:"success",onClick:s},"Log in with Spotify")}const y="74f4c65fa40120881e93ed2e2e832c7d",b="Leicester";function _(){const[e,t]=Object(n.useState)(null);return Object(n.useEffect)(()=>{fetch(`https://api.openweathermap.org/data/2.5/weather?q=${b}&units=metric&appid=${y}`).then(e=>e.json()).then(e=>{t({temp:e.main.temp,condition:e.weather[0].main,icon:e.weather[0].icon})}).catch(console.error)},[]),e?r.a.createElement(d.a,{border:"info",style:{maxWidth:"300px"}},r.a.createElement(d.a.Body,{className:"d-flex align-items-center"},r.a.createElement("img",{src:`https://openweathermap.org/img/wn/${e.icon}@2x.png`,alt:e.condition,className:"me-3"}),r.a.createElement("div",null,r.a.createElement(d.a.Title,null,b),r.a.createElement(d.a.Text,null,e.temp,"\xb0C \u2013 ",e.condition)))):r.a.createElement(u.a,{animation:"border",role:"status",size:"sm"},r.a.createElement("span",{className:"visually-hidden"},"Loading weather..."))}var k=a(30);function S(){const[e,t]=Object(n.useState)(null);return Object(n.useEffect)(()=>{fetch("/calendar.json").then(e=>{if(!e.ok)throw new Error("Failed to load calendar JSON");return e.json()}).then(e=>{const a=new Date,n=e.filter(e=>new Date(e.end)>=a).sort((e,t)=>new Date(e.start)-new Date(t.start));t(n)}).catch(e=>{console.error("Failed to load calendar",e),t([])})},[]),null===e?r.a.createElement(u.a,{animation:"border",role:"status",size:"sm"},r.a.createElement("span",{className:"visually-hidden"},"Loading events...")):r.a.createElement(d.a,null,r.a.createElement(d.a.Header,null,"\ud83d\udcc5 Upcoming Events"),r.a.createElement(k.a,{variant:"flush"},0===e.length&&r.a.createElement(k.a.Item,{className:"text-muted"},"No upcoming events."),e.map(e=>r.a.createElement(k.a.Item,{action:!0,href:e.url,target:"_blank",key:e.uid},r.a.createElement("div",{className:"fw-bold text-truncate"},e.summary),r.a.createElement("small",{className:"text-muted"},new Date(e.start).toLocaleString("en-GB",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),e.location&&` \u2022 ${e.location}`)))))}var N=function(){return r.a.createElement(o.a,{className:"py-5"},r.a.createElement("header",{className:"mb-5 text-center"},r.a.createElement("h1",{className:"display-4"},"Welcome to J4mesT\u2019s Site")),r.a.createElement(s.a,{className:"mb-4"},r.a.createElement(i.a,null,r.a.createElement("h2",{className:"h4"},"Now Listening"),r.a.createElement(E,null))),r.a.createElement(s.a,null,r.a.createElement(i.a,{md:6,className:"mb-4"},r.a.createElement("h2",{className:"h4"},"Weather"),r.a.createElement(_,null)),r.a.createElement(i.a,{md:6},r.a.createElement(S,null))))};a(23);l.a.createRoot(document.getElementById("root")).render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(N,null)))}},[[13,1,2]]]);
//# sourceMappingURL=main.ffc89111.chunk.js.map